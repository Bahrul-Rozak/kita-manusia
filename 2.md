# Performance Testing dengan K6: Skenario Login User

Halo teman-teman, sekarang kita akan mengembangkan skenario performance testing yang lebih kompleks yaitu testing untuk proses login user. Latar belakang dari skenario ini adalah untuk menguji performa sistem dalam menangani alur autentikasi yang melibatkan multiple request dan maintain session. Skenario login merupakan salah satu critical path dalam aplikasi web karena merupakan pintu masuk utama bagi pengguna untuk mengakses fitur-fitur terproteksi. Kita akan mensimulasikan pengguna yang mengakses halaman utama, kemudian navigasi ke halaman login, melakukan submit credential, dan akhirnya diarahkan ke dashboard setelah login berhasil.

Dalam skenario real-world, proses login tidak hanya melibatkan satu request tunggal tetapi serangkaian interaksi antara client dan server yang mencakup request halaman login, submit form, dan redirect ke halaman tujuan. Kita perlu menangani aspek-aspek seperti session management dan cookie handling yang merupakan komponen essential dalam flow autentikasi. Pendekatan testing ini akan membantu kita mengidentifikasi bottleneck tidak hanya pada endpoint login itu sendiri tetapi juga pada keseluruhan flow autentikasi.

## File: `kf-lab-login-test.js`

```javascript
import http from 'k6/http';
import { check, sleep } from 'k6';

export const options = {
  scenarios: {
    kf_lab_login_test: {
      executor: 'constant-vus',
      vus: 20,
      duration: '5m',
      gracefulStop: '0s',
    },
  },
  thresholds: {
    http_req_failed: ['rate<0.05'],
    http_req_duration: ['p(95)<3000'],
    'http_req_duration{page:home}': ['p(95)<2000'],
    'http_req_duration{page:login}': ['p(95)<2000'],
    'http_req_duration{page:login_submit}': ['p(95)<3000'],
    'http_req_duration{page:dashboard}': ['p(95)<2000'],
  },
  cloud: {
    distribution: {
      'amazon:us:ashburn': { loadZone: 'amazon:us:ashburn', percent: 100 },
    },
  },
};

export default function () {
  // Step 1: Akses halaman utama
  const homeResponse = http.get('https://kf-lab.sahabatbelajar.com/', {
    tags: { page: 'home' }
  });

  check(homeResponse, {
    'home page status 200': (r) => r.status === 200,
    'home page loaded successfully': (r) => r.body.length > 0,
  });

  sleep(1);

  // Step 2: Akses halaman login
  const loginPageResponse = http.get('https://kf-lab.sahabatbelajar.com/login.php', {
    tags: { page: 'login' }
  });

  check(loginPageResponse, {
    'login page status 200': (r) => r.status === 200,
    'login form is present': (r) => r.body.includes('login') || r.body.includes('form'),
  });

  sleep(1);

  // Step 3: Submit login credentials
  const loginPayload = {
    username: 'rozak',
    password: '12345678',
  };

  const loginSubmitResponse = http.post(
    'https://kf-lab.sahabatbelajar.com/login.php',
    loginPayload,
    {
      tags: { page: 'login_submit' }
    }
  );

  check(loginSubmitResponse, {
    'login submit status 200': (r) => r.status === 200,
    'login successful - redirected to dashboard': (r) => 
      r.url.includes('dashboard') || r.status === 302 || r.body.includes('dashboard'),
    'session created successfully': (r) => r.headers['Set-Cookie'] !== undefined,
  });

  sleep(1);

  // Step 4: Akses halaman dashboard setelah login
  const dashboardResponse = http.get('https://kf-lab.sahabatbelajar.com/dashboard/index.php', {
    tags: { page: 'dashboard' }
  });

  check(dashboardResponse, {
    'dashboard page status 200': (r) => r.status === 200,
    'dashboard content loaded': (r) => r.body.length > 0,
    'user is authenticated': (r) => !r.body.includes('login') || r.body.includes('rozak'),
  });

  sleep(2);
}
```

## Penjelasan Detail Step by Step

Mari kita bahas secara komprehensif setiap bagian dari skenario login testing yang telah kita rancang. File yang kita buat bernama `kf-lab-login-test.js` yang secara spesifik mendeskripsikan tujuan test yaitu menguji proses login pada sistem KF Lab. Penamaan yang jelas ini membantu dalam organisasi test suite dan memudahkan identifikasi tujuan masing-masing test script.

Pada bagian konfigurasi `options`, kita masih mempertahankan skenario dengan 20 virtual users selama 5 menit menggunakan constant VUs executor. Namun yang berbeda adalah kita menambahkan threshold yang lebih detail dengan menggunakan tags. Threshold `http_req_duration` yang umum kita pertahankan di bawah 3000ms untuk 95th percentile, tetapi kita juga menambahkan threshold spesifik untuk setiap halaman dalam flow login. Halaman home, login, dan dashboard kita targetkan di bawah 2000ms, sementara proses login submit yang typically lebih berat kita beri toleransi hingga 3000ms. Pendekatan ini memungkinkan kita untuk mengidentifikasi secara spesifik bagian mana dalam flow yang mengalami performance issue.

Fungsi utama test kita sekarang terbagi menjadi empat step yang merepresentasikan complete user journey dalam proses login. Step pertama adalah mengakses halaman utama https://kf-lab.sahabatbelajar.com/. Request ini dilabeli dengan tag `page:home` yang memungkinkan kita tracking performance metric khusus untuk halaman ini. Check yang kita lakukan memverifikasi bahwa halaman utama dapat diakses dengan status 200 dan content berhasil diload.

Setelah berhasil mengakses halaman utama, virtual user akan menunggu 1 detik sebelum melanjutkan ke step kedua. Think time ini mensimulasikan perilaku user real yang membaca konten atau melakukan navigasi manual ke halaman login. Pada step kedua, user mengakses halaman login https://kf-lab.sahabatbelajar.com/login.php dengan tag `page:login`. Check yang dilakukan memastikan bahwa halaman login tersedia dan mengandung form login yang diperlukan.

Step ketiga adalah core dari test scenario ini yaitu submit credential login. Kita menyiapkan payload yang berisi username 'rozak' dan password '12345678' kemudian melakukan HTTP POST request ke endpoint login.php. Request ini dilabeli dengan tag `page:login_submit` yang memiliki threshold khusus mengingat proses autentikasi typically lebih resource intensive. Check yang kita lakukan pada response login sangat comprehensive: memverifikasi status response, memastikan user di-redirect ke dashboard setelah login berhasil, dan memvalidasi bahwa session cookie telah dibuat. Check untuk redirect dapat berupa pengecekan URL yang mengandung 'dashboard', status code 302 (redirect), atau content body yang mengindikasikan halaman dashboard.

Step keempat dan terakhir adalah mengakses halaman dashboard https://kf-lab.sahabatbelajar.com/dashboard/index.php setelah login berhasil. Request ini menggunakan session yang telah terbentuk dari step sebelumnya. Check yang dilakukan memverifikasi bahwa hashboard dapat diakses, content terload dengan baik, dan yang paling penting memastikan bahwa user benar-benar dalam state authenticated dengan mengecek bahwa tidak ada element login yang muncul atau username 'rozak' muncul dalam content.

Setelah berhasil mengakses dashboard, kita menambahkan sleep 2 detik yang lebih panjang untuk mensimulasikan user yang menghabiskan waktu di dashboard sebelum kemungkinan melakukan action lainnya atau logout. Keseluruhan flow ini dengan think time yang appropriate menciptakan simulasi yang sangat mendekati perilaku user real dalam menggunakan aplikasi web.

Aspek penting yang perlu dicatat adalah K6 secara otomatis menangani cookie dan session management. Ketika server mengirim Set-Cookie header pada response login, K6 akan secara otomatis menyimpan cookie tersebut dan mengirimkannya kembali pada subsequent requests ke domain yang sama. Ini adalah behavior yang critical untuk testing flow login karena tanpa maintain session, request ke dashboard akan dianggap unauthenticated dan di-redirect kembali ke halaman login.

Dengan skenario testing seperti ini, kita tidak hanya mengukur performance technical dari masing-masing endpoint tetapi juga mengvalidasi functional correctness dari login flow. Kita dapat mendeteksi issues seperti broken authentication flow, session management problems, atau performance degradation pada specific step dalam user journey. Threshold yang kita tetapkan memberikan safety net untuk memastikan bahwa pengalaman user dalam proses login tetap acceptable bahkan under load.

Jadi seperti itu lah implementasi dan penjelasan detail mengenai skenario login testing dengan K6 yang mencakup complete user flow dari awal akses halaman utama hingga berhasil masuk ke dashboard. Pendekatan ini memberikan comprehensive insight tidak hanya tentang raw performance tetapi juga reliability dan correctness dari sistem autentikasi yang merupakan critical component dalam aplikasi web modern.
