# Performance Testing dengan K6: Skenario Registrasi User

Halo teman-teman, sekarang kita akan mengembangkan skenario performance testing untuk proses registrasi user yang merupakan salah satu flow kritis dalam aplikasi web. Latar belakang dari skenario ini adalah untuk menguji kemampuan sistem dalam menangani proses pendaftaran pengguna baru yang melibatkan multiple steps dan validasi data. Skenario registrasi biasanya lebih kompleks daripada login karena melibatkan pengecekan duplikasi data, validasi email, dan penyimpanan data user baru ke database. Kita akan mensimulasikan pengguna yang mengakses halaman utama, navigasi ke halaman registrasi, mengisi form pendaftaran, dan kemudian melakukan login dengan akun yang baru dibuat.

Dalam dunia nyata, proses registrasi merupakan gateway pertama bagi pengguna baru untuk bergabung dengan platform. Performance yang buruk pada proses registrasi dapat langsung berdampak pada conversion rate dan user acquisition. Testing ini akan membantu kita mengidentifikasi bottleneck pada proses penyimpanan data user baru, validasi real-time, dan integrasi antara berbagai komponen sistem.

## File: `kf-lab-register-test.js`

```javascript
import http from 'k6/http';
import { check, sleep } from 'k6';

export const options = {
  scenarios: {
    kf_lab_register_test: {
      executor: 'constant-vus',
      vus: 15,
      duration: '5m',
      gracefulStop: '0s',
    },
  },
  thresholds: {
    http_req_failed: ['rate<0.05'],
    http_req_duration: ['p(95)<3000'],
    'http_req_duration{page:home}': ['p(95)<2000'],
    'http_req_duration{page:register}': ['p(95)<2000'],
    'http_req_duration{page:register_submit}': ['p(95)<4000'],
    'http_req_duration{page:login_after_register}': ['p(95)<2000'],
    'http_req_duration{page:login_submit_after_register}': ['p(95)<3000'],
    'http_req_duration{page:dashboard_after_register}': ['p(95)<2000'],
  },
  cloud: {
    distribution: {
      'amazon:us:ashburn': { loadZone: 'amazon:us:ashburn', percent: 100 },
    },
  },
};

export default function () {
  // Generate unique data untuk menghindari duplikasi
  const timestamp = Date.now();
  const uniqueUsername = `ahmad_${timestamp}`;
  const uniqueEmail = `ahmad_${timestamp}@gmail.com`;

  // Step 1: Akses halaman utama
  const homeResponse = http.get('https://kf-lab.sahabatbelajar.com/', {
    tags: { page: 'home' }
  });

  check(homeResponse, {
    'home page status 200': (r) => r.status === 200,
    'home page loaded successfully': (r) => r.body.length > 0,
  });

  sleep(1);

  // Step 2: Akses halaman registrasi
  const registerPageResponse = http.get('https://kf-lab.sahabatbelajar.com/register.php', {
    tags: { page: 'register' }
  });

  check(registerPageResponse, {
    'register page status 200': (r) => r.status === 200,
    'register form is present': (r) => r.body.includes('register') || r.body.includes('form'),
  });

  sleep(1);

  // Step 3: Submit form registrasi
  const registerPayload = {
    full_name: 'Ahmad Oriza',
    username: uniqueUsername,
    email: uniqueEmail,
    password: '12345678',
  };

  const registerSubmitResponse = http.post(
    'https://kf-lab.sahabatbelajar.com/register.php',
    registerPayload,
    {
      tags: { page: 'register_submit' }
    }
  );

  check(registerSubmitResponse, {
    'register submit status 200': (r) => r.status === 200,
    'register successful - redirected to login': (r) => 
      r.url.includes('login') || r.status === 302 || r.body.includes('login'),
    'no duplicate user error': (r) => !r.body.includes('already exists') && !r.body.includes('duplicate'),
  });

  sleep(1);

  // Step 4: Akses halaman login setelah registrasi berhasil
  const loginPageResponse = http.get('https://kf-lab.sahabatbelajar.com/login.php', {
    tags: { page: 'login_after_register' }
  });

  check(loginPageResponse, {
    'login page status 200 after register': (r) => r.status === 200,
    'login form is present after register': (r) => r.body.includes('login') || r.body.includes('form'),
  });

  sleep(1);

  // Step 5: Login dengan akun yang baru dibuat
  const loginPayload = {
    username: uniqueUsername,
    password: '12345678',
  };

  const loginSubmitResponse = http.post(
    'https://kf-lab.sahabatbelajar.com/login.php',
    loginPayload,
    {
      tags: { page: 'login_submit_after_register' }
    }
  );

  check(loginSubmitResponse, {
    'login after register status 200': (r) => r.status === 200,
    'login after register successful - redirected to dashboard': (r) => 
      r.url.includes('dashboard') || r.status === 302 || r.body.includes('dashboard'),
    'session created after register': (r) => r.headers['Set-Cookie'] !== undefined,
  });

  sleep(1);

  // Step 6: Akses halaman dashboard setelah login dengan akun baru
  const dashboardResponse = http.get('https://kf-lab.sahabatbelajar.com/dashboard/index.php', {
    tags: { page: 'dashboard_after_register' }
  });

  check(dashboardResponse, {
    'dashboard page status 200 after register': (r) => r.status === 200,
    'dashboard content loaded after register': (r) => r.body.length > 0,
    'new user is authenticated': (r) => !r.body.includes('login') || r.body.includes('dashboard'),
  });

  sleep(2);
}
```

## Penjelasan Detail Step by Step

Mari kita bahas secara mendalam setiap aspek dari skenario registrasi testing yang telah kita rancang. File `kf-lab-register-test.js` ini memiliki kompleksitas yang lebih tinggi dibandingkan skenario sebelumnya karena melibatkan dua proses utama: registrasi dan login dengan akun baru. Penamaan file yang jelas membantu dalam membedakan berbagai skenario testing yang kita miliki.

Pada bagian konfigurasi `options`, kita mengurangi sedikit jumlah virtual users menjadi 15 untuk skenario registrasi. Hal ini dilakukan karena proses registrasi typically lebih berat daripada proses login biasa, melibatkan operasi database yang lebih intensif seperti pengecekan uniqueness dan insertion data baru. Threshold yang kita tetapkan juga lebih detail dengan penambahan metric spesifik untuk setiap step dalam flow registrasi. Proses register submit kita beri threshold 4000ms yang lebih longgar mengingat kompleksitas operasi yang dilakukan.

Salah aspek kritis dalam testing registrasi adalah penanganan data unik. Pada awal fungsi test, kita generate unique identifier menggunakan timestamp untuk username dan email. Pendekatan ini sangat penting untuk menghindari conflict duplikasi data ketika multiple virtual users menjalankan test secara bersamaan. Dengan menggunakan timestamp, kita memastikan bahwa setiap virtual user akan mendaftarkan akun dengan data yang unik, sehingga menghindari error "user already exists" yang dapat mengganggu akurasi test results.

Step pertama dan kedua masih konsisten dengan skenario sebelumnya yaitu mengakses halaman utama dan halaman registrasi. Namun pada step kedua, kita mengakses `register.php`而不是 `login.php`. Check yang dilakukan memverifikasi bahwa form registrasi tersedia dan dapat diakses oleh user.

Step ketiga adalah core dari skenario registrasi yaitu submit form pendaftaran. Kita menyiapkan payload yang berisi full_name "Ahmad Oriza", username unique, email unique, dan password. Penting untuk diperhatikan bahwa field names harus sesuai dengan yang diharapkan oleh server, dalam hal ini `full_name` (bukan `fullName` atau `name`). Request POST ke `register.php` ini dilabeli dengan tag khusus dan memiliki check yang comprehensive: memverifikasi status response, memastikan user di-redirect ke halaman login setelah registrasi berhasil, dan yang paling penting memvalidasi bahwa tidak ada error duplikasi data.

Step keempat adalah mengakses halaman login setelah registrasi berhasil. Step ini mensimulasikan user yang kembali ke halaman login untuk melakukan authentication dengan akun yang baru dibuat. Check dilakukan untuk memastikan halaman login dapat diakses dengan normal.

Step kelima adalah proses login dengan akun yang baru saja didaftarkan. Kita menggunakan username unique yang telah digenerate sebelumnya dan password yang sesuai. Check pada response login memverifikasi bahwa proses autentikasi berhasil dan user di-redirect ke dashboard. Validasi session creation juga dilakukan untuk memastikan mekanisme session management bekerja dengan baik.

Step keenam dan terakhir adalah mengakses halaman dashboard dengan akun yang baru dibuat. Check yang dilakukan memastikan bahwa user baru dapat mengakses dashboard dengan normal dan berada dalam state authenticated. Sleep 2 detik di akhir mensimulasikan user yang mengeksplorasi dashboard setelah berhasil registrasi dan login.

Aspek penting yang membedakan skenario registrasi dengan login adalah dependency chain-nya. Dalam skenario registrasi, success pada step-step awal merupakan prerequisite untuk step-step berikutnya. Jika registrasi gagal, maka proses login dengan akun baru juga tidak dapat dilakukan. Oleh karena itu, check yang kita implementasi harus robust enough untuk menangani berbagai kemungkinan response dari server.

Dengan skenario testing yang komprehensif ini, kita dapat mengukur tidak hanya performance technical tetapi juga reliability dari entire user onboarding process. Kita dapat mengidentifikasi issues seperti slow database queries pada proses pengecekan uniqueness, performance bottleneck pada email sending mechanism (jika ada), atau problems dalam session initialization untuk user baru.

Threshold yang kita tetapkan memberikan baseline yang realistic untuk proses registrasi. Proses submit registrasi yang lebih kompleks diberi toleransi waktu response yang lebih longgar, sementara halaman-halaman static tetap diharapkan loading dengan cepat. Pendekatan ini membantu kita dalam prioritizing optimization efforts berdasarkan impact terhadap user experience.

Jadi seperti itu lah implementasi dan penjelasan detail mengenai skenario registrasi testing dengan K6 yang mencakup complete user journey dari awal mengakses website hingga berhasil membuat akun baru dan masuk ke dashboard. Testing semacam ini sangat valuable untuk memastikan bahwa first impression pengguna baru terhadap aplikasi kita adalah positive dan seamless, yang pada akhirnya berkontribusi terhadap user acquisition dan retention rates.
