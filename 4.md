# Performance Testing dengan K6: Skenario Transaksi dan Verifikasi Pembayaran

Halo teman-teman, sekarang kita akan mengembangkan skenario performance testing yang lebih advance yaitu testing untuk proses transaksi dan upload bukti pembayaran. Latar belakang dari skenario ini adalah untuk menguji performa sistem dalam menangani alur bisnis yang kompleks yang melibatkan multiple pages, file upload, dan state management. Skenario ini mensimulasikan pengguna yang perlu melakukan verifikasi pembayaran untuk mengakses kursus, yang merupakan flow kritis dalam platform e-learning.

Dalam aplikasi real-world, proses upload file dan verifikasi pembayaran merupakan operasi yang resource-intensive karena melibatkan handling binary data, storage management, dan processing file. Testing ini akan membantu kita mengidentifikasi bottleneck pada proses upload file, validasi file type, dan integrasi dengan payment verification system.

## File: `kf-lab-transaction-test.js`

```javascript
import http from 'k6/http';
import { check, sleep } from 'k6';
import { htmlReport } from "https://raw.githubusercontent.com/benc-uk/k6-reporter/main/dist/bundle.js";

export const options = {
  scenarios: {
    kf_lab_transaction_test: {
      executor: 'constant-vus',
      vus: 15,
      duration: '5m',
      gracefulStop: '0s',
    },
  },
  thresholds: {
    http_req_failed: ['rate<0.05'],
    http_req_duration: ['p(95)<3000'],
    'http_req_duration{page:home}': ['p(95)<2000'],
    'http_req_duration{page:login}': ['p(95)<2000'],
    'http_req_duration{page:login_submit}': ['p(95)<3000'],
    'http_req_duration{page:dashboard}': ['p(95)<2000'],
    'http_req_duration{page:profile}': ['p(95)<2000'],
    'http_req_duration{page:profile_update}': ['p(95)<5000]',
  },
  cloud: {
    distribution: {
      'amazon:us:ashburn': { loadZone: 'amazon:us:ashburn', percent: 100 },
    },
  },
};

export default function () {
  // Step 1: Akses halaman utama
  const homeResponse = http.get('https://kf-lab.sahabatbelajar.com/', {
    tags: { page: 'home' }
  });

  check(homeResponse, {
    'home page status 200': (r) => r.status === 200,
    'home page loaded successfully': (r) => r.body.length > 0,
  });

  sleep(1);

  // Step 2: Akses halaman login
  const loginPageResponse = http.get('https://kf-lab.sahabatbelajar.com/login.php', {
    tags: { page: 'login' }
  });

  check(loginPageResponse, {
    'login page status 200': (r) => r.status === 200,
    'login form is present': (r) => r.body.includes('login') || r.body.includes('form'),
  });

  sleep(1);

  // Step 3: Submit login credentials
  const loginPayload = {
    username: 'budi',
    password: '12345678',
  };

  const loginSubmitResponse = http.post(
    'https://kf-lab.sahabatbelajar.com/login.php',
    loginPayload,
    {
      tags: { page: 'login_submit' }
    }
  );

  check(loginSubmitResponse, {
    'login submit status 200': (r) => r.status === 200,
    'login successful - redirected to dashboard': (r) => 
      r.url.includes('dashboard') || r.status === 302 || r.body.includes('dashboard'),
    'session created successfully': (r) => r.headers['Set-Cookie'] !== undefined,
  });

  sleep(1);

  // Step 4: Akses halaman dashboard setelah login
  const dashboardResponse = http.get('https://kf-lab.sahabatbelajar.com/dashboard/index.php', {
    tags: { page: 'dashboard' }
  });

  check(dashboardResponse, {
    'dashboard page status 200': (r) => r.status === 200,
    'dashboard content loaded': (r) => r.body.length > 0,
    'user is authenticated': (r) => !r.body.includes('login'),
    'payment verification message present': (r) => r.body.includes('verifikasi pembayaran') || r.body.includes('verification'),
  });

  sleep(1);

  // Step 5: Akses halaman profile untuk upload bukti pembayaran
  const profileResponse = http.get('https://kf-lab.sahabatbelajar.com/dashboard/profile.php', {
    tags: { page: 'profile' }
  });

  check(profileResponse, {
    'profile page status 200': (r) => r.status === 200,
    'profile page loaded successfully': (r) => r.body.length > 0,
    'file upload form present': (r) => r.body.includes('payment_proof') || r.body.includes('file') || r.body.includes('upload'),
  });

  sleep(1);

  // Step 6: Prepare file upload - bukti pembayaran
  // Karena kita tidak bisa upload file real di load test, kita simulasi dengan multipart form data
  const profileUpdatePayload = {
    payment_proof: http.file('fake_payment.png', 'fake-image-content', 'image/png')
  };

  const profileUpdateResponse = http.post(
    'https://kf-lab.sahabatbelajar.com/dashboard/profile.php',
    profileUpdatePayload,
    {
      tags: { page: 'profile_update' }
    }
  );

  check(profileUpdateResponse, {
    'profile update status 200': (r) => r.status === 200,
    'profile update successful': (r) => 
      r.body.includes('success') || r.body.includes('berhasil') || r.body.includes('updated'),
    'no upload error': (r) => !r.body.includes('error') && !r.body.includes('gagal'),
  });

  sleep(2);
}

export function handleSummary(data) {
  return {
    "transaction-test-summary.html": htmlReport(data),
  };
}
```

## Penjelasan Detail Step by Step

Mari kita bahas secara komprehensif setiap bagian dari skenario transaksi dan upload bukti pembayaran yang telah kita rancang. File `kf-lab-transaction-test.js` ini memiliki kompleksitas tinggi karena melibatkan authenticated session, navigation across multiple pages, dan file upload operation. Penamaan file yang jelas mencerminkan tujuan test yaitu menguji flow transaksi dan verifikasi pembayaran.

Pada bagian konfigurasi `options`, kita menggunakan 15 virtual users dengan durasi 5 menit. Threshold yang ditetapkan mencakup metric spesifik untuk setiap step dalam flow transaksi. Perhatikan bahwa threshold untuk `profile_update` kita set lebih longgar menjadi 5000ms karena proses upload file typically membutuhkan waktu lebih lama dibandingkan request biasa. Kita juga menambahkan HTML report generator untuk memudahkan analisis hasil test.

Step pertama hingga ketiga konsisten dengan skenario login sebelumnya, namun dengan kredensial spesifik user 'budi' yang memerlukan verifikasi pembayaran. Proses login ini critical karena membentuk session yang akan digunakan throughout the entire transaction flow.

Step keempat adalah mengakses dashboard setelah login berhasil. Pada step ini, kita melakukan check yang spesifik untuk memverifikasi bahwa user memang memerlukan verifikasi pembayaran. Check `'payment verification message present'` menggunakan pattern matching untuk mendeteksi pesan "verifikasi pembayaran" atau kata "verification" dalam response body. Ini memastikan bahwa kita berada dalam state yang benar sebelum melanjutkan ke step upload.

Step kelima adalah navigasi ke halaman profile untuk upload bukti pembayaran. Kita mengakses `https://kf-lab.sahabatbelajar.com/dashboard/profile.php` dan memverifikasi bahwa halaman profile berhasil load dan form upload file tersedia. Check `'file upload form present'` mencari keberadaan field `payment_proof` atau elemen file upload dalam HTML response.

Step keenam adalah core dari skenario transaksi ini yaitu upload bukti pembayaran. Karena dalam environment load testing kita tidak dapat mengupload file real, kita menggunakan simulasi multipart form data dengan `http.file()` function dari K6. Kita membuat file PNG dummy dengan nama `fake_payment.png` dan content `fake-image-content`. Meskipun bukan file gambar real, approach ini mensimulasikan behavior file upload termasuk headers dan encoding yang appropriate.

Beberapa aspek kritis dalam step upload ini adalah:
1. **Field Name**: Kita menggunakan `payment_proof` sebagai field name yang sesuai dengan expected field di form HTML
2. **Content Type**: Kita specify `image/png` sebagai content type yang valid
3. **Error Handling**: Check yang komprehensif untuk mendeteksi success message dan menghindari false positive pada error scenarios

Setelah upload berhasil, kita menambahkan sleep 2 detik untuk mensimulasikan user yang menunggu konfirmasi atau melakukan action lainnya setelah upload.

Aspek penting yang perlu diperhatikan dalam skenario ini adalah **session persistence**. K6 secara otomatis menangani cookies dan session, sehingga ketika kita login di step 3, session tersebut akan otomatis digunakan pada subsequent requests ke domain yang sama. Ini critical untuk memastikan bahwa request ke halaman profile dan upload file dilakukan dalam context user yang terautentikasi.

Dalam real-world scenario, proses upload file dan verifikasi pembayaran biasanya melibatkan:
- File size validation
- File type validation (hanya menerima format tertentu)
- Image processing (jika perlu thumbnail generation)
- Storage integration (local storage atau cloud storage)
- Database update untuk menandai status pembayaran
- Notification system untuk admin

Dengan skenario testing yang komprehensif ini, kita dapat mengidentifikasi berbagai potential bottlenecks:
- Performance degradation pada file upload handler
- Memory issues ketika handling multiple concurrent file uploads
- Database contention pada update operation
- Storage I/O limitations
- Session management issues under load

Threshold yang kita tetapkan memberikan realistic expectation untuk setiap operation. Proses upload file diberi toleransi waktu response yang lebih besar mengingat kompleksitas operasinya, sementara halaman-halaman informational diharapkan loading dengan cepat.

Pendekatan testing seperti ini sangat valuable untuk memastikan bahwa critical business flow seperti verifikasi pembayaran dapat handle traffic yang expected tanpa compromising user experience. Dalam context e-learning platform, smooth payment verification process langsung berdampak pada user's ability to access course content dan overall satisfaction.

Jadi seperti itu lah implementasi dan penjelasan detail mengenai skenario transaksi dan upload bukti pembayaran dengan K6 yang mencakup complete user journey dari login hingga upload verification document. Testing semacam ini essential untuk memastikan bahwa core business processes tetap reliable dan performant under various load conditions.
